# Desktop Celebrator (MVP)

| 项目 | 内容 |
| :--- | :--- |
| **产品名称** | Desktop Celebrator (暂定名) |
| **版本号** | v0.1.0 (MVP) |
| **核心技术** | Tauri v2, Rust, React, canvas-confetti |
| **目标平台** | macOS (优先适配), Windows |
| **主要功能** | 全局快捷键/Git操作触发全屏彩带特效 |

---

## 1. 产品概述
### 1.1 背景与目的
现代数字工作缺乏即时反馈与仪式感。本产品旨在提供一个极轻量级的桌面端“情绪反馈引擎”，通过视觉奖励（如彩带）来提升用户的多巴胺分泌，增强工作成就感或演示趣味性。

### 1.2 MVP 核心目标
1.  **轻量化验证**：验证 Tauri + 透明窗口 + canvas-confetti 的技术可行性与性能表现。
2.  **Git 工作流集成**：实现基于本地服务的 Git Hook 监听，验证“生产力伴侣”场景。
3.  **高颜值 UI**：建立符合现代审美的 macOS 风格设置面板。

---

## 2. 功能模块详解

### 2.1 核心模块：全屏特效层 (Overlay)
这是应用的“舞台”，默认不可见，触发时覆盖全屏。

*   **F-1.1 全屏透明穿透**
    *   应用启动后，创建一个覆盖主屏幕的透明窗口。
    *   **关键特性**：窗口默认必须处于 `Ignore Cursor Events`（鼠标穿透）状态，用户点击屏幕应直接穿透到下方的应用（如 VS Code），不干扰正常工作。
*   **F-1.2 彩带渲染 (Canvas Confetti)**
    *   使用 `canvas-confetti` 库渲染粒子动画。
    *   **触发逻辑**：接收到后端信号 -> 窗口置顶并显示 -> 播放动画 -> 动画结束 -> 清除 Canvas 并隐藏窗口。
    *   **预设效果**：MVP 提供两种硬编码预设。
        1.  **Particle Burst (小庆祝)**：从屏幕下方中心向上喷射一束彩带（类似 iMessage 特效）。
        2.  **School Pride (大庆祝)**：从屏幕两侧向中间持续喷射彩带 3 秒。

### 2.2 触发模块 (Trigger System)
负责监听外部信号并通知特效层。

*   **F-2.1 全局快捷键**
    *   允许用户自定义两组快捷键：
        *   触发“小庆祝” (默认: `Alt + C` / `Option + C`)
        *   触发“大庆祝” (默认: `Alt + Shift + C`)
*   **F-2.2 Git 操作监听 (HTTP Server)**
    *   应用在后台启动一个轻量级 HTTP Server (端口如 `23333`)。
    *   监听 `POST /trigger` 请求。
    *   **逻辑**：收到请求 -> 解析 Body 中的 `type` (success/error) -> 触发对应特效。
*   **F-2.3 Git Hook 一键安装**
    *   在设置面板提供“安装 Git 监听脚本”按钮。
    *   **执行动作**：在用户目录写入一个通用 Hook 脚本，并配置 `git config --global core.hooksPath`。

### 2.3 设置面板 (Settings UI)
采用 **macOS System Settings (Ventura+)** 的设计语言。

*   **F-3.1 布局规范**
    *   **左侧边栏 (Sidebar)**：宽度固定，半透明毛玻璃效果，列出功能导航（通用、触发器、关于）。
    *   **右侧内容区**：白色/深色背景，圆角卡片式布局。
*   **F-3.2 导航菜单结构**
    1.  **通用 (General)**
        *   开关：开机自启。
        *   开关：音效 (Sound FX) - MVP 仅需开关，暂不需选文件。
    2.  **触发器 (Triggers)**
        *   **快捷键设置区**：输入框录制按键组合。
        *   **Git 集成区**：
            *   状态显示：未安装 / 已监听 (检测本地服务是否存活)。
            *   按钮：`Install Git Hooks` (安装脚本)。
            *   说明文案：简单的使用指南。
    3.  **关于 (About)**
        *   版本信息、Github 链接。

### 2.4 系统托盘 (System Tray)
*   **F-4.1 托盘菜单**
    *   `Open Settings` (打开设置面板)
    *   `Pause/Resume` (暂停监听 - 避免开会时尴尬)
    *   `Quit` (完全退出)

---

## 3. 技术规格与性能要求

### 3.1 架构设计 (Tauri v2)
*   **Backend (Rust)**:
    *   管理 `GlobalShortcut` 插件。
    *   运行 `tiny_http` 或 `warp` 服务监听 Git 请求。
    *   控制主窗口的 `Show/Hide` 和 `SetIgnoreCursorEvents`。
*   **Frontend (React + TailwindCSS)**:
    *   **路由 A (Overlay)**: 纯透明背景，仅包含 `<canvas id="confetti">`。
    *   **路由 B (Settings)**: 负责 UI 交互。

### 3.2 性能指标
*   **内存占用 (Idle)**: < 30MB (得益于 Tauri 的共享 WebView 机制)。
*   **CPU 占用 (Idle)**: < 0.1%。
*   **动画帧率**: 保持 60fps，若系统负载过高自动降级粒子数量。

### 3.3 兼容性
*   **macOS**: 11.0 (Big Sur) 及以上 (为了更好的 WebView 支持)。
*   **Windows**: Windows 10/11 (需安装 WebView2 Runtime，Win11 自带)。

---

## 4. UI 设计细则 (macOS 风格参考)

*   **配色**: 自动适配系统深色/浅色模式 (Dark Mode Support)。
*   **字体**:
    *   Mac: `San Francisco` (系统默认)
    *   Win: `Segoe UI`
*   **控件风格**:
    *   **Toggle**: iOS 风格的绿色开关。
    *   **Sidebar**: 选中项为圆角矩形灰色背景，图标为 SVG。
    *   **Input**: 只有底部边框或极简边框。

---

## 5. 开发路线图 (Roadmap)

### 第一阶段：原型 (P0)
1.  搭建 Tauri v2 脚手架。
2.  实现透明窗口 + 鼠标穿透逻辑。
3.  引入 `canvas-confetti`，实现硬编码的快捷键触发撒花。

### 第二阶段：UI与配置 (P1)
1.  实现 macOS 风格设置页面前端。
2.  Rust 端实现配置持久化（保存快捷键设置）。
3.  实现系统托盘逻辑。

### 第三阶段：Git 集成 (P2)
1.  Rust 端编写 HTTP Server。
2.  编写 Shell/Batch Hook 脚本。
3.  实现前端“一键安装”逻辑。

### 第四阶段：未来规划 (v0.2.0+)
*   支持自定义 WebM 视频素材。
*   支持创意工坊（下载别人的特效配置）。
*   支持 OBS 虚拟摄像头输出（用于直播）。

---

## 6. 附录：Git Hook 脚本逻辑 (伪代码参考)

```bash
#!/bin/sh
# Path: ~/.celebrator/hooks/post-commit

# 异步发送请求，不阻塞 git 进程
(curl -s -X POST http://127.0.0.1:23333/trigger \
    -H "Content-Type: application/json" \
    -d '{"event": "commit", "result": "success"}' > /dev/null &)
```